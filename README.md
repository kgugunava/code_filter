# Для чего нужен данный инструмент
1. Экстракция метаданных из исходного кода
2. Фильтрация документов в базе знаний 

## Экстракция метаданных из исходного кода
Выполняет **code_filter.py**
1. Метод extract_context извлекает метаданные в виде словаря, который затем передается в функцию фильтрации чанков из базы знаний (реализация в **kb_local_hybrid.py**, см. ниже)
2. Метод **get_code_info** извлекает метаданные в виде структуры **CodeInfo**
``` python
class CodeInfo(TypedDict, total=False):
    language: LanguageInfo
    imports: List[ImportsInfo]
    classes: List[ClassInfo]
    functions: List[FunctionInfo]
```
Данная структура может маппиться в JSON-файл вида:
``` json
{
  "language": {
    "language": ""
  },
  "imports": [
    [
      {
        "type": "",
        "modules": {
          "module": ""
        },
        "names": []
      }
    ],
    
  ],
  "classes": [
    {
      "name": "",
      "superclasses": [],
      "functions": [
        {
          "decorators": ,
          "name": "",
          "parameters": [
            {
              "name": ""
            },
          ]
        },
      ]     
    }
  ],
  "functions": [
    {
        "decorators": ,
        "name": "",
        "parameters": [
            {
                "name": ""
            },
        ]
    },
  ]
}
```
Метаданные в JSON-формате могут быть встроены в каждый документ базы знаний (чанк), как поле **info**

## Фильтрация документов в базе знаний 
Выполняет **kb_local_hybrid.py**
### Пайплайн 
1. Создание локальной базы знаний

    База знаний включает в себя:
    
    - **chunks.json** - хранилище документов базы знаний в JSON-формате
    - **bm25_tolkens.json** - чанки документов, разбитые на токены
    - **vectors.npy** - векторы документов

2. Из переданного файла извлекаются метаданные с помощью **code_filter.Filter** в виде словаря

3. Из базы знаний **chunks.json** извлекаются документы, метаданные которых совпадают с извлеченными из переданного файла метаданными

## Как это можно использовать в COIR на примере датасета codetrans-dl
https://huggingface.co/datasets/CoIR-Retrieval/codetrans-dl

**Пайплайн фильтрации**

1. Каждый элемент датасета (corpus) имеет поле **text**, содержащее исходный код документа
2. К каждому элементу датасета применяется функция экстракции метаданных с помощью методов, реализованных в **code_filter** 
3. Построение базы знаний (реализация в **kb_local_hybrid**)
4. Использование методов фильтрации базы знаний, реализованных в **kb_local_hybrid**
5. Использование различных видов поиска в уже отфильтрованной базе знаний